# Аудио- и видеозвонок пользователю

**Акторы:** авторизованные пользователи, приложение.

**Цель:** пользователь совершает аудио- или видеозвонок с другим авторизованным пользователем, чтобы пообщаться с ним напрямую.

**Предусловия:** у авторизованного пользователя открыт чат с конкретным авторизованным пользователем, к которому он хочет совершить аудио- или видеозвонок.

**Сценарий:**
1. Пользователь открывает меню для выбора типа звонка.
2. Приложение предлагает выбрать тип звонка: аудиозвонок или видеозвонок.
3. Пользователь выбирает аудиозвонок.

Пользователь может [совершить видеозвонок](#Совершение_видеозвонка).

4. Приложение отправляет запрос на совершение аудиозвонка пользователю, которому звонят.
5. Приложение ждет ответа от пользователя, которому звонят (30 сек).
6. Приложение получает ответ от пользователя, которому звонят.

Приложение получает ответ ["Пользователь не отвечает" (или "Пользователь занят" или "Пользователь разговаривает")](#Пользователь_не_отвечает) от пользователя, которому звонят.

7. Приложение отправляет запрос на совершение аудиозвонка.
8. Приложение просит пользователя включить микрофон.
9. Приложение открывает соединение (канал связи) для предачи данных в цифровом виде, используя протокол IP.

{Успешное создание аудиозвонка}

10. Приложение возвращает ответ успешного совершения звонка.
11. Приложение открывает окно вызова.
12. Приложение начинает обмен данными по протоколу UDP/IP, передавая аудиоданные (и видеоданные в случае выбора видеозвонка).
13. Один из пользователей завершает звонок.
14. Приложение посылает запрос на завершение звонка.
15. Приложение возвращает ответ успешного завершения звонка.
16. Приложение закрывает окно вызова.
17. Приложение сохраняет данные о звонке в БД (никнеймы пользователей, длительность, дата и время начала разговора, дата и время конца разговора).
18. Приложение уведомляет пользователей о совершенном звонке (длительность, дата и время начала разговора, дата и время конца разговора).

**Результат:**
* Пользователь успешно совершил аудио- или видеозвонок с другим пользователем.
* В персональном чате отображается время начала, конца и длительность разговора.

**Исключения:**
1. Если пользователь не отвечает 30 секунд приложение возвращает ошибку "Пользователь не отвечает".
2. Если пользователь сбрасывает звонок приложение возвращает ошибку "Пользователь занят".
3. Если пользователь в данный момент совершает аудио- или видеозвонок другому пользователю в системе приложение возвращает ошибку "Пользователь разговаривает".


**Альтернативный сценарий:**

3а. <a name="Совершение_видеозвонка"></a> *Совершение видеозвонка*.  

3а1. Приложение отправляет запрос на совершение видеоозвонка пользователю, которому звонят.  
3а2. Приложение ждет ответа от пользователя, которому звонят (30 сек).  
3а3. Приложение получает ответ от пользователя, которому звонят.  

Приложение получает ответ ["Пользователь не отвечает" (или "Пользователь занят" или "Пользователь разговаривает")](#Пользователь_не_отвечает) от пользователя, которому звонят.

3а4. Приложение отправляет запрос на совершение видеозвонка.  
3а5. Приложение просит пользователя включить микрофон и камеру.  
3а6. Приложение открывает соединение (канал связи) для предачи данных в цифровом виде, используя протокол IP.  

Возврат на шаг 10 {Успешное завершение аудиозвонка}.



6а. <a name="Пользователь_не_отвечает"></a> *Пользователь не отвечает (или "Пользователь занят" или "Пользователь разговаривает")*.  

6а1. Приложение уведомляет пользователя о неуспешной попытке аудио- (или видео-) звонка.  
6а2. Приложение сохраняет данные о неуспешной попытке звонка в БД (никнеймы пользователей, дата и время звонка).   
6а2. Приложение уведомляет пользователя (которому пытались позвонить) о неуспешной попытке звонка от пользователя, который звонил.  

# Диаграмма activity
![activity_for_personal_call](http://www.plantuml.com/plantuml/png/pLHDYzj03BtFhn3qua2XXTxYomPwsKFRi1_iMHdBcw6svCveDYtanzVou6QzTIdqqZqb5i_lGq_uAYb6pNtdplU9ujbDpsxxYJY32YJgo2leaK1_30JIWiUkgztvpOurVClqS0nAvzqmTC6Z1k6p2orKj-ilRcp2K65kWfI90zW-OD30Zz1A18H8QH1E16sKVgB8YI9K7zv38h-f7O19t2nW1fdPlJ2JLwE6aVs6Hfz9BK-FNmcGuQ9V_mxI71c49-K--2Z3KPXcu9U1E0524R74K5tlOHz5nKitsQCk4LIJQnQ54gWP4ywMFek6Db02QSrEvfIzfvJQt06gKZ_ynUujFjd26bG4F4ZM1OT15qGMfJdKBzNdtHOAUrotOYv_oTEOf7MkP7mA3QqNMOZdBl-jlVNwu29Qpw2xFzK6oCq8xIcYWVzRXURvrLLOVhPtHxeKfG88BtpK4wPOEWLkv0HYEnpdzn_txwxt9GLzzqVaHteB6f5J7zIEeLnlGLJ8JLd5ffu_EOLQ-g4ZgyASMegYwzpos_Bi6Yp5C-Hsn-b4qIOB-ol4gu5y9ud6H7ClCxGO3-MkxFy14usmqe37cTfAIAM5XV-aChWhuYRttKy00 "Диаграмма activity")

# Диаграмма sequence
![sequence_for_personal_call](http://www.plantuml.com/plantuml/png/lP6nQiD038RtUmgHAO7c1JAKcBv0IUXirBC2HsNvUf82UVlU9KFSug6bfJTea3x-JvRtQbZCHmxwbYHZmH6KtfqaqdETf9WoYe7BG8MJK0WORIhmebJ2wrJxM2wmwdBc5D7I92j0XIw4Hi3s4ReT78afMc-NJ7r4vlMcfQGp6ZMoWstbhlmE3cHUPDtOJHXepiqZ3sr9jQMuW6oW7YEfdfmXebA0-XOznQkdJJ-vMcDcUsgM6tQ7lcJ-D78QCvDH7_y--uXdwkyNk2a4Hte0IwqENgx_wfTQOYLm-UwjJyYw40EBwxlymmT0Uu5a2FjQVEGF "Диаграмма sequence")
