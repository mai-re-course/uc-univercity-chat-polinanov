# Аудио- и видеозвонок пользователю

**Акторы:** авторизованный пользователь, фронтенд, бекенд.

**Цель:** пользователь совершает аудио- или видеозвонок с другим пользователем, чтобы пообщаться с ним напрямую.

**Предусловия:** у авторизованного пользователя открыт чат с конкретным пользователем, к которому он хочет совершить аудио- или видеозвонок.

**Сценарий:**
1. Пользователь открывает меню для выбора типа звонка.
2. Приложение предлагает выбрать тип звонка: аудиозвонок или видеозвонок.
3. Пользователь выбирает аудиозвонок.

Пользователь может [совершить видеозвонок](# сценарий видеозвонка) ссылка!.

4. Бекенд отправляет запрос на совершение аудиозвонка пользователю, которому звонят.
4. Приложение ждет ответа от пользователя, которому звонят (30 сек).
5. Приложение получает ответ от пользователя, которому звонят.
4. Приложение отправляет в бекенд запрос на совершение аудиозвонка.
7. Приложение просит пользователя включить микрофон.
4. Приложение открывает соединение (канал связи) для предачи данных в цифровом виде, используя протокол IP.

{Успешное создание аудиозвонка}

5. Бекенд возвращает ответ успешного совершения звонка.
6. Приложение открывает окно вызова.
7. Приложение начинает обмен данными по протоколу UDP/IP.
8. Один из пользователей завершает звонок.
8. Бекенд возвращает ответ успешного завершения звонка.
6. Приложение сохраняет данные о звонке в БД (длительность, время начала разговора, время конца разговора).

**Результат:**
* Пользователь успешно совершил аудио- или видеозвонок.
* В персональном чате отображается время начала, конца и длительность разговора.

**Исключения:**
1. Если пользователь не отвечает 30 секунд "Пользователь не отвечает".
2. Сбрасывает звонок показывается ошибка "Пользователь занят".
2. Если пользователь в данный момент совершает аудиозвонок другому пользователю в системе показывается ошибка "Пользователь разговаривает".


**Альтернативный сценарий:**

[Совершение видеозвонка], если пользователь нажал на кнопку "видеозвонок".

4. Бекенд отправляет запрос на совершение аудиозвонка пользователю, которому звонят.
4. Приложение ждет ответа от пользователя, которому звонят (30 сек).
5. Приложение получает ответ от пользователя, которому звонят.
4. Приложение отправляет в бекенд запрос на совершение аудиозвонка.
7. Приложение просит пользователя включить микрофон и камеру.
4. Приложение открывает соединение (канал связи) для предачи данных в цифровом виде, используя протокол IP.
Возврат на шаг 5 {Успешное завершение аудиозвонка}.

