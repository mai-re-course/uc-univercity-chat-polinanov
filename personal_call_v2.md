# Аудио- и видеозвонок пользователю

**Акторы:** авторизованные пользователи, фронтенд, бекенд.

**Цель:** пользователь совершает аудио- или видеозвонок с другим авторизованным пользователем, чтобы пообщаться с ним напрямую.

**Предусловия:** у авторизованного пользователя открыт чат с конкретным авторизованным пользователем, к которому он хочет совершить аудио- или видеозвонок.

**Сценарий:**
1. Пользователь открывает меню для выбора типа звонка.
2. Приложение предлагает выбрать тип звонка: аудиозвонок или видеозвонок.
3. Пользователь выбирает аудиозвонок.

Пользователь может [совершить видеозвонок](#Совершение_видеозвонка).

4. Бекенд отправляет запрос на совершение аудиозвонка пользователю, которому звонят.
5. Приложение ждет ответа от пользователя, которому звонят (30 сек).
6. Приложение получает ответ от пользователя, которому звонят.
7. Приложение отправляет в бекенд запрос на совершение аудиозвонка.
8. Приложение просит пользователя включить микрофон.
9. Приложение открывает соединение (канал связи) для предачи данных в цифровом виде, используя протокол IP.

{Успешное создание аудиозвонка}

10. Бекенд возвращает ответ успешного совершения звонка.
11. Приложение открывает окно вызова.
12. Приложение начинает обмен данными по протоколу UDP/IP, передавая аудиоданные (и видеоданные в случае выбора видеозвонка).
13. Один из пользователей завершает звонок.
14. Бекенд возвращает ответ успешного завершения звонка.
15. Приложение сохраняет данные о звонке в БД (длительность, время начала разговора, время конца разговора).

**Результат:**
* Пользователь успешно совершил аудио- или видеозвонок с другим пользователем.
* В персональном чате отображается время начала, конца и длительность разговора.

**Исключения:**
1. Если пользователь не отвечает 30 секунд "Пользователь не отвечает".
2. Сбрасывает звонок показывается ошибка "Пользователь занят".
3. Если пользователь в данный момент совершает аудиозвонок другому пользователю в системе показывается ошибка "Пользователь разговаривает".


**Альтернативный сценарий:**

<a name="Совершение_видеозвонка"></a> *Совершение видеозвонка*.

4. Бекенд отправляет запрос на совершение видеоозвонка пользователю, которому звонят.
5. Приложение ждет ответа от пользователя, которому звонят (30 сек).
6. Приложение получает ответ от пользователя, которому звонят.
7. Приложение отправляет в бекенд запрос на совершение видеозвонка.
8. Приложение просит пользователя включить микрофон и камеру.
9. Приложение открывает соединение (канал связи) для предачи данных в цифровом виде, используя протокол IP.

Возврат на шаг 10 {Успешное завершение аудиозвонка}.


